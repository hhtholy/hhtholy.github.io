---
layout: post
title: hibernate的缓存机制
categories: Blog
description: 缓存
keywords: hibernate,java
---

### 什么是缓存

其实就是一块内存空间,内存的话读写速度自然快，缓存中存放的数据量非常大时，也会用硬盘作为缓存介质，将数据源(数据库或者文件)中的数据放在缓存中，再次获取数据源的时候，可以直接去缓存中获取，从而提升程序性能！




## 为什么使用缓存机制

> 作用

Hibernate是一个持久层的框架，经常访问物理数据库，为了降低应用程序对数据库访问的频率，于是用到了缓存，缓存内的数据是对数据源中数据的拷贝，操作数据库的时候不是访问数据库，而是从缓存中进行数据读取，从而程序性能得到提升！（好像说了都一样）

### hibernate的缓存

>一级缓存
其实就是session对象里的一系列集合中的对象

这是hibernate框架内置的不可卸载的缓存，生命周期和session的生命周期是一致的，由于session对象的生命周期通常对应一个事务，它的缓存是事务范围内的缓存，或者叫做session级别的缓存,一级缓存中，持久化类的每个实例对象都具有唯一的OID。

>二级缓存

又称作"SessionFactory级别的缓存"或者"SessionFactory的缓存"，由于sessionFactory对象的生命周期和程序的整个运行过程是一致的，它的缓存是进程范围或者集群范围的缓存。默认是没有开启的，需要进行手动配置。

在集群环境中，缓存被一个机器或者多个机器的进程共享。缓存中的数据被复制到集群环境中的每个进程节点，进程间通过远程通信来保证缓存中的数据的一致性，缓存中的数据通常采用对象的松散数据形式。显然在程序级别的生命周期情况下，二级缓存是存在并发问题的，而且集群范围内的缓存访问速度不一定比数据库访问快，集群节点之间通信广播就费时间~

>缓存简单的方法证明

在同一个session对象下进行两次查询，第一次是有发送sql语句的，第二次是没有发送sql语句的


>同步数据源和缓存（针对一级缓存）（持久化对象有自动更新数据库的能力）
--快照机制


1、 查询数据库  session.get(xxx.class,oid)
2、 修改缓存区域数据 持久化实例对象.set("值")
3、 commit之前  比对缓存区域和快照区域是否一致  不一致的话 修改数据库中的值 同时快照区数据也进行更新  session.commit()
4、 session销毁后 缓存销毁 session.close()



